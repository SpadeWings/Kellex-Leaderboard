<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kellex Schools - Nova Vanguards Leaderboard</title>

  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap">

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Particles.js for stars -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
</head>
<body>

  <!-- Particles.js Background -->
  <div id="particles-js"></div>

  <!-- Sun, Moon, Planet -->
  <!-- Sun Icon -->
<svg class="sun" width="48" height="48" viewBox="0 0 512 512" fill="#FFB300">
  <path d="M256 118a22 22 0 01-22-22V48a22 22 0 0144 0v48a22 22 0 01-22 22zM256 486a22 22 0 01-22-22v-48a22 22 0 0144 0v48a22 22 0 01-22 22zM369.14 164.86a22 22 0 01-15.56-37.55l33.94-33.94a22 22 0 0131.11 31.11l-33.94 33.94a21.93 21.93 0 01-15.55 6.44zM108.92 425.08a22 22 0 01-15.55-37.56l33.94-33.94a22 22 0 0131.11 31.11l-33.94 33.94a21.94 21.94 0 01-15.56 6.45zM464 278h-48a22 22 0 010-44h48a22 22 0 010 44zM96 278H48a22 22 0 010-44h48a22 22 0 010 44zM403.08 425.08a21.94 21.94 0 01-15.56-6.45l-33.94-33.94a22 22 0 0131.11-31.11l33.94 33.94a22 22 0 01-15.55 37.56zM142.86 164.86a21.89 21.89 0 01-15.55-6.44l-33.94-33.94a22 22 0 0131.11-31.11l33.94 33.94a22 22 0 01-15.56 37.55zM256 358a102 102 0 11102-102 102.12 102.12 0 01-102 102z"/>
</svg>

<!-- Moon Icon -->
<svg class="moon" width="48" height="48" viewBox="0 0 512 512" fill="#E0E0E0">
  <path d="M264 480A232 232 0 0132 248c0-94 54-178.28 137.61-214.67a16 16 0 0121.06 21.06C181.07 76.43 176 104.66 176 136c0 110.28 89.72 200 200 200 31.34 0 59.57-5.07 81.61-14.67a16 16 0 0121.06 21.06C442.28 426 358 480 264 480z"/>
</svg>

<!-- Planet 1 Icon -->
<svg class="planet planet1" width="48" height="48" viewBox="0 0 512 512" fill="#42A5F5">
  <path d="M256 48C141.13 48 48 141.13 48 256s93.13 208 208 208 208-93.13 208-208S370.87 48 256 48zm0 368c-88.22 0-160-71.78-160-160S167.78 96 256 96s160 71.78 160 160-71.78 160-160 160z"/>
  <path d="M256 128c-10.45 0-19.15 7.33-19.15 17.75s8.7 17.75 19.15 17.75 19.15-7.33 19.15-17.75S266.45 128 256 128zM336 256c0 10.45-7.33 19.15-17.75 19.15s-17.75-8.7-17.75-19.15 7.33-19.15 17.75-19.15S336 245.55 336 256zM194.75 211.25c-10.45 0-17.75 7.3-17.75 17.75s7.3 17.75 17.75 17.75 17.75-7.3 17.75-17.75-7.3-17.75-17.75-17.75z"/>
</svg>

<!-- Planet 2 Icon -->
<svg class="planet planet2" width="48" height="48" viewBox="0 0 512 512" fill="#EF5350">
  <path d="M256 48C141.13 48 48 141.13 48 256s93.13 208 208 208 208-93.13 208-208S370.87 48 256 48zm0 368c-88.22 0-160-71.78-160-160S167.78 96 256 96s160 71.78 160 160-71.78 160-160 160z"/>
  <path d="M256 128c-10.45 0-19.15 7.33-19.15 17.75s8.7 17.75 19.15 17.75 19.15-7.33 19.15-17.75S266.45 128 256 128zM336 256c0 10.45-7.33 19.15-17.75 19.15s-17.75-8.7-17.75-19.15 7.33-19.15 17.75-19.15S336 245.55 336 256zM194.75 211.25c-10.45 0-17.75 7.3-17.75 17.75s7.3 17.75 17.75 17.75 17.75-7.3 17.75-17.75-7.3-17.75-17.75-17.75z"/>
</svg>
  <!-- Header -->
  <header>
    <h1>Kellex Schools</h1>
    <h2>Nova Vanguards - Command Nexus</h2>
    <h3>Secondary Learners Leaderboard</h3>
  </header>

  <main>
    <table id="leaderboardTable">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Name</th>
          <th>Class</th>
          <th>Score</th>
          <th>Change</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
    </table>

    <div id="leaderboardCards" class="cards-container"></div>
  </main>

  <footer>
    <p>Sir Paul</p>
    <p>Computer Studies Teacher and Coding Club Instructor</p>
    <p>&copy; 2025</p>
  </footer>

  <!-- Firebase + leaderboard JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBS_oX2uqItfNqd-7G9TSHnP-RUxviNLWc",
      authDomain: "leaderboard-900f1.firebaseapp.com",
      projectId: "leaderboard-900f1",
      storageBucket: "leaderboard-900f1.firebasestorage.app",
      messagingSenderId: "511470946131",
      appId: "1:511470946131:web:96bfb89e797a6bf12f03a6",
      measurementId: "G-WNNMR7PYYD"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let previousScores = {};

    async function loadLeaderboard() {
      const q = query(collection(db, "learners"), orderBy("score", "desc"));
      const snapshot = await getDocs(q);

      const tableBody = document.getElementById("leaderboardBody");
      const cardsContainer = document.getElementById("leaderboardCards");
      tableBody.innerHTML = "";
      cardsContainer.innerHTML = "";

      let rank = 1;
      snapshot.forEach(doc => {
        const data = doc.data();
        const change = getChangeSymbol(data.name, data.LastScore);
        previousScores[data.name] = data.score;

        const starsHTML = renderStars(data.score);

        const row = document.createElement("tr");  

let rankClass = '';
let nameClass = '';
if(rank === 1){ rankClass='rank-1'; nameClass='name-1'; }
else if(rank === 2){ rankClass='rank-2'; nameClass='name-2'; }
else if(rank === 3){ rankClass='rank-3'; nameClass='name-3'; }

row.innerHTML = `
  <td class="${rankClass}">${rank}</td>
  <td class="name ${nameClass}">${data.name}</td>
  <td>${data.class}</td>
  <td>${starsHTML}</td>
  <td>${change}</td>
`;  
tableBody.appendChild(row);

        const card = document.createElement("div");
        card.classList.add("learner-card");
        card.innerHTML = `
          <p class="rank">#${rank}</p>
          <p class="name">${data.name}</p>
          <p class="class">${data.class}</p>
          <p class="score">${data.score} <span class="sparkle">‚≠ê</span></p>
          <p class="change">${change}</p>
        `;
        cardsContainer.appendChild(card);

        rank++;
      });
    }

    function renderStars(score) {
      return `<span class="score-num">${score} <span class="sparkle">‚≠ê</span></span>`;
    }

    function getChangeSymbol(currentScore, lastScore){
  if(lastScore === undefined) return '';
  if(currentScore > lastScore) return '<span class="up">‚¨ÜÔ∏è</span>';
  if(currentScore < lastScore) return '<span class="down">‚¨áÔ∏è</span>';
  return '';
}

// üîπ Optional: Update learner score in Firestore with lastScore
  async function updateLearnerScore(name, newScore) {
    const learnerRef = doc(db, "learners", name);
    const snapshot = await getDoc(learnerRef);
    const data = snapshot.data();

    await updateDoc(learnerRef, {
      lastScore: data.score, // üîπ Save old score
      score: newScore        // üîπ Update new score
    });

    loadLeaderboard(); // üîπ Refresh leaderboard
  }
  

    loadLeaderboard();
    setInterval(loadLeaderboard, 10000);
  </script>

  <script>
    particlesJS("particles-js", {
      particles: {
        number: { value: 120, density: { enable: true, value_area: 800 } },
        color: { value: "#ffffff" },
        shape: { type:"circle" },
        opacity: { value:0.8, random:true, anim:{ enable:true, speed:1, opacity_min:0.3, sync:false }},
        size:{ value:2, random:true },
        line_linked:{ enable:false },
        move:{ enable:true, speed:0.2, direction:"none", random:true, straight:false, out_mode:"out" }
      },
      interactivity:{ detect_on:"canvas", events:{ onhover:{ enable:false }, onclick:{ enable:false } }},
      retina_detect:true
    });
  </script>

</body>
</html>
